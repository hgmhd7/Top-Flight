<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        body {
            margin: 0;
        }
    </style>

    <meta charset="UTF-8">
    <title>U.S. Demographics Correlations</title>


    <!-- <link rel="apple-touch-icon-precomposed" sizes="57x57" href="apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="mstile-310x310.png" /> -->


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="https:cdn.jsdelivr.net/npm/d3-dsv"></script>
    <script src="https:cdn.jsdelivr.net/npm/index-array-by"></script>

    <script src="https:cdn.jsdelivr.net/npm/globe.gl"></script>
    <!-- <script src="https://top/unpkg.com/globe.gl"></script> -->
    <!--<script src="../../dist/globe.gl.js"></script>-->
    <link rel="stylesheet" href="static/css/force_layout.css">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>



</head>

<body>
    <!-- <div class="container">
    <div class="row">

      <div class="col-lg-10">

        <div id="globeViz"></div>

      </div> -->
    <!-- <script>
      var delayInMilliseconds = 100000; //1 second

      setTimeout(function() {
        //your code to be executed after 1 second
      }, delayInMilliseconds);
    </script> -->
    <!-- <div class="col-lg-2">
        <div id="scatter" class="sidebar"></div>
      </div>
    </div>
  </div> -->

    <!-- <script>
    var layer1 = svg.append('g');
    var layer2 = svg.append('g');
  </script> -->

    <div id="globeViz"></div>

    <div id="scatter" class="sidebar"></div>




    <script>
        const COUNTRY = 'United States';
        const OPACITY = 0.1;

        var MAP_CENTER = { lat: 37.6, lng: -16.6, altitude: 0.4 };

        const colorScale = d3.interpolateRgb("steelblue", "rgba(255, 165, 0, 0.75)");

        const getColor = d => d.alt / Math.max(1e5, d.alt);

        const opacity = 0.2





        // const myGlobe = layer1.append(Globe())
        const myGlobe = Globe()

            (document.getElementById('globeViz'))
            .globeImageUrl('https:cdn.jsdelivr.net/npm/three-globe/example/img/earth-night.jpg')
            .pointOfView({ lat: 39.6, lng: -98.5, altitude: 2 }) // aim at continental US centroid
            // .arcLabel(d => `${d.airline}: ${d.srcIata} &#8594; ${d.dstIata}`)
            .arcStartLat(d => +d.srcAirport.lat)
            .arcStartLng(d => +d.srcAirport.lng)
            .arcEndLat(d => +d.dstAirport.lat)
            .arcEndLng(d => +d.dstAirport.lng)
            .arcDashLength(0.25)
            .arcDashGap(1)
            .arcDashInitialGap(() => Math.random())
            .arcDashAnimateTime(4000)
            .arcColor(d => [`rgba(0, 255, 0, ${OPACITY})`, `rgba(255, 0, 0, ${OPACITY})`])
            .arcsTransitionDuration(0)



            .labelLat(d => +d.lat)
            .labelLng(d => +d.lng)
            .labelText(d => "")
            .labelLabel(d => d.name)
            .labelSize(d => "")
            // .labelDotRadius(d => +d.alt / 25000)
            .labelColor(() => 'orange')
            .labelResolution(2)
            .onLabelClick(d => window.open("http://www.bing.com/"))
            // // .onLabelClick(d => window.open(d.name))
            ;
        // .onLabelHover(hoverLabel => myGlobe
        //     .labelColor(d => {
        //         const changeHighlight = !hoverLabel ? opacity : d === hoverLabel ? .08 : opacity / 1;
        //         return [`rgba(0, 255, 0, ${changeHighlight})`, `rgba(255, 0, 0, ${changeHighlight})`];
        //     })
        // )

        // .onLabelHover(hoverLabel => myGlobe
        // .labelAltitude(d => d === hoverLabel ? 20 : 0)
        // // .labelColor(d => d === hoverLabel ? 'green' : 'orange')
        // );


        // Add auto-rotation
        myGlobe.controls().autoRotate = true;
        myGlobe.controls().autoRotateSpeed = 0.3;


        // MAP_CENTER = { lat: 98.6, lng: -100.6, altitude: 2 };

        // myGlobe.pointOfView(MAP_CENTER)


        // function wait(ms) {
        //     var d = new Date();
        //     var d2 = null;
        //     do { d2 = new Date(); }
        //     while (d2 - d < ms);
        // }

        // wait(4000);


        const svg2 = d3.select('#button').append('svg')

        function change_view() {

            

            MAP_CENTER_1 = { lat: 39.6, lng: -98.5, altitude: .5 };


            console.log(MAP_CENTER_1);


            myGlobe
                .pointOfView(MAP_CENTER_1, 3000)
                .controls().autoRotate = false;

        }

        function change_view_2() {

            MAP_CENTER_2 = { lat: 39.6, lng: -98.5, altitude: 2 };

            myGlobe
                .pointOfView(MAP_CENTER_2, 800)
                .controls().autoRotate = true;

        }





        // myGlobe.controls().autoRotate = true;
        // myGlobe.controls().autoRotateSpeed = 0.3;

        myGlobe.getCoords({ lat: 35.9, lng: 104.8, altitude: 8 });

        // load data
        const airportParse = ([airportId, name, city, country, iata, icao, lat, lng, alt, timezone, dst, tz, type, source]) => ({ airportId, name, city, country, iata, icao, lat, lng, alt, timezone, dst, tz, type, source });
        const routeParse = ([airline, airlineId, srcIata, srcAirportId, dstIata, dstAirportId, codeshare, stops, equipment]) => ({ airline, airlineId, srcIata, srcAirportId, dstIata, dstAirportId, codeshare, stops, equipment });
        Promise.all([
            fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat').then(res => res.text())
                .then(d => d3.csvParseRows(d, airportParse)),
            fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/routes.dat').then(res => res.text())
                .then(d => d3.csvParseRows(d, routeParse))
        ]).then(([airports, routes]) => {
            const byIata = indexBy(airports, 'iata', false);
            const filteredRoutes = routes
                .filter(d => byIata.hasOwnProperty(d.srcIata) && byIata.hasOwnProperty(d.dstIata)) // exclude unknown airports
                .filter(d => d.stops === '0') // non-stop flights only
                .map(d => Object.assign(d, {
                    srcAirport: byIata[d.srcIata],
                    dstAirport: byIata[d.dstIata]
                }))
                .filter(d => d.srcAirport.country === COUNTRY && d.dstAirport.country !== COUNTRY); // international routes from country

            //  .filter(d => d.srcAirport.country); // international routes from country
            console.log(routes)

            const filtered_airports = airports
                .filter(d => d.country === COUNTRY);

            myGlobe
                .labelsData(filtered_airports)
                .arcsData(filteredRoutes);


            console.log(filtered_airports)

            console.log(airports.length)
        });



    </script>



    <button id="button" onclick="change_view()">Zoom In</button>

    <button id="button" onclick="change_view_2()">Zoom Out</button>



    <script type="text/javascript" src="static/js/build_navigator.js"></script>



</body>

</html>