<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        body {
            margin: 0;
        }
    </style>

    <meta charset="UTF-8">
    <title>U.S. Demographics Correlations</title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="https:cdn.jsdelivr.net/npm/d3-dsv"></script>
    <script src="https:cdn.jsdelivr.net/npm/index-array-by"></script>

    <script src="https:cdn.jsdelivr.net/npm/globe.gl"></script>
    <!-- <script src="https://top/unpkg.com/globe.gl"></script> -->
    <!--<script src="../../dist/globe.gl.js"></script>-->
    <link rel="stylesheet" href="assets/css/force_layout.css">
</head>

<body>
    <!-- <div class="container">
    <div class="row">

      <div class="col-lg-10">

        <div id="globeViz"></div>

      </div> -->
    <!-- <script>
      var delayInMilliseconds = 100000; //1 second

      setTimeout(function() {
        //your code to be executed after 1 second
      }, delayInMilliseconds);
    </script> -->
    <!-- <div class="col-lg-2">
        <div id="scatter" class="sidebar"></div>
      </div>
    </div>
  </div> -->

    <!-- <script>
    var layer1 = svg.append('g');
    var layer2 = svg.append('g');
  </script> -->

    <div id="globeViz"></div>

    <div id="scatter" class="sidebar"></div>


    <script>
        const COUNTRY = 'United States';
        const OPACITY = 0.1;
        // const myGlobe = layer1.append(Globe())
        const myGlobe = Globe()

        (document.getElementById('globeViz'))
        .globeImageUrl('https:cdn.jsdelivr.net/npm/three-globe/example/img/earth-night.jpg')
            .pointOfView({
                lat: 39.6,
                lng: -98.5,
                altitude: 2
            }) // aim at continental US centroid
            .arcLabel(d => `${d.airline}: ${d.srcIata} &#8594; ${d.dstIata}`)
            .arcStartLat(d => +d.srcAirport.lat)
            .arcStartLng(d => +d.srcAirport.lng)
            .arcEndLat(d => +d.dstAirport.lat)
            .arcEndLng(d => +d.dstAirport.lng)
            .arcDashLength(0.25)
            .arcDashGap(1)
            .arcDashInitialGap(() => Math.random())
            .arcDashAnimateTime(4000)
            .arcColor(d => [`rgba(0, 255, 0, ${OPACITY})`, `rgba(255, 0, 0, ${OPACITY})`])
            .arcsTransitionDuration(0)

        .pointColor(() => 'orange')
            .pointAltitude(0)
            .pointRadius(0.02)
            .pointsMerge(true)


        .labelText("text")
            .labelSize(.25)
            .labelDotRadius(.25)
            .labelColor(() => 'rgba(255, 165, 0, 0.75)')
            .labelResolution(2);


        ;


        // load data
        const airportParse = ([airportId, name, city, country, iata, icao, lat, lng, alt, timezone, dst, tz, type, source]) => ({
            airportId,
            name,
            city,
            country,
            iata,
            icao,
            lat,
            lng,
            alt,
            timezone,
            dst,
            tz,
            type,
            source
        });
        const routeParse = ([airline, airlineId, srcIata, srcAirportId, dstIata, dstAirportId, codeshare, stops, equipment]) => ({
            airline,
            airlineId,
            srcIata,
            srcAirportId,
            dstIata,
            dstAirportId,
            codeshare,
            stops,
            equipment
        });
        Promise.all([
            fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat').then(res => res.text())
            .then(d => d3.csvParseRows(d, airportParse)),
            fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/routes.dat').then(res => res.text())
            .then(d => d3.csvParseRows(d, routeParse))
        ]).then(([airports, routes]) => {
            const byIata = indexBy(airports, 'iata', false);

            console.log(byIata)


            const filteredRoutes = routes
                .filter(d => byIata.hasOwnProperty(d.srcIata) && byIata.hasOwnProperty(d.dstIata)) // exclude unknown airports
                .filter(d => d.stops === '0') // non-stop flights only
                .map(d => Object.assign(d, {
                    srcAirport: byIata[d.srcIata],
                    dstAirport: byIata[d.dstIata]
                }))
                .filter(d => d.srcAirport.country === COUNTRY && d.dstAirport.country !== COUNTRY); // international routes from country

            //  .filter(d => d.srcAirport.country); // international routes from country
            // console.log(airports)


            myGlobe
                .pointsData(airports)
                .arcsData(filteredRoutes);
        });



        Promise.all([
            fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat').then(res => res.text())
            .then(d => d3.csvParseRows(d, airportParse))
        ]).then(([airports2]) => {


            console.log(airports2)
            myGlobe

                .labelsData(airports2)

        });
    </script>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

    <script type="text/javascript" src="assets/js/app.js"></script>

</body>

</html>